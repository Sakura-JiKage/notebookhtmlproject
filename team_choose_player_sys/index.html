<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ÈõÑËÅîÁõüÈòµÂÆπÁ≥ªÁªü</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        :root {
            --primary-color: #0d6efd;
            --danger-color: #dc3545;
            --success-color: #198754;
        }

        body {
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .main-content {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 25px;
            flex: 1;
            margin: 15px auto;
            max-width: 1400px;
            width: 95%;
        }

        .copyright {
            background-color: #343a40;
            color: white;
            text-align: center;
            padding: 15px 0;
            width: 100%;
            margin-top: auto;
        }

        .content-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding-bottom: 60px;
        }

        .import-export-area {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .formation-list-area {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 15px;
        }

        .formation-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .formation-tag {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .formation-tag:hover {
            background-color: #e9ecef;
        }

        .formation-tag.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .formation-tag-name {
            font-weight: 500;
        }

        .formation-tag-actions {
            display: flex;
            gap: 4px;
        }

        .formation-tag-btn {
            background: none;
            border: none;
            padding: 2px 6px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.2s;
        }

        .formation-tag-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        .team-area,
        .player-pool-area {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 15px;
        }

        .teams-container {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        @media (max-width: 1400px) {
            .teams-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 992px) {
            .teams-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .teams-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .teams-container {
                grid-template-columns: 1fr;
            }
        }

        .area-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
        }

        .area-title {
            display: flex;
            align-items: center;
        }

        .area-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .team-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            min-height: 320px;
        }

        .team-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .team-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .team-number {
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background-color: #6f42c1;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 8px;
            font-size: 0.85rem;
        }

        .team-name {
            font-weight: bold;
            color: #495057;
            margin-right: 8px;
            font-size: 1.0rem;
        }

        .team-actions {
            display: flex;
            gap: 4px;
        }

        .team-members {
            margin-top: 8px;
        }

        .member-item {
            padding: 10px 8px;
            border-bottom: 1px dashed #f1f3f4;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 65px;
            transition: all 0.2s;
            cursor: move;
            position: relative;
        }

        .member-item:hover {
            background-color: #f8f9fa;
        }

        .member-item.dragging {
            opacity: 0.5;
            background-color: #e9ecef;
        }

        .member-item.drag-over {
            background-color: #e3f2fd;
            border: 1px dashed #2196f3;
        }

        .member-left {
            display: flex;
            flex-direction: column;
            justify-content: center;
            flex: 1;
        }

        .player-name-container {
            margin-bottom: 6px;
        }

        .player-name-static {
            font-weight: 500;
            color: #212529;
            font-size: 0.9rem;
            line-height: 1.2;
            font-weight: bold;
            word-break: break-word;
            white-space: normal;
        }

        .player-name-static-href {
            color: #212529;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.2s ease;
            border-bottom: 1px solid transparent;
            padding-bottom: 1px;
            display: inline-block;
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            vertical-align: middle;
        }

        .player-name-static-href:hover {
            color: var(--primary-color);
            text-decoration: none;
            border-bottom: 1px solid var(--primary-color);
            transform: translateY(-1px);
        }

        .player-name-static-href:active {
            transform: translateY(0);
        }

        /* Á°Æ‰øùÂú®ÊúâË∫´‰ªΩÊ†áÁ≠æÊó∂‰πüËÉΩÊ≠£Á°ÆÊòæÁ§∫ */
        .player-name-static .player-name-static-href {
            margin-right: 4px;
        }

        .member-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
            position: relative;
            height: 100%;
        }

        .position-and-level {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
            transition: opacity 0.2s;
        }

        .position-tag {
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: 500;
            color: white;
            display: inline-block;
        }

        .player-level {
            display: inline-block;
            min-width: 24px;
            height: 16px;
            border-radius: 8px;
            text-align: center;
            line-height: 16px;
            font-size: 0.6rem;
            font-weight: bold;
        }

        .level-Â§ß‰πò {
            background-color: #ff0000;
            color: white;
        }

        .level-Âêà‰Ωì {
            background-color: #ff4500;
            color: white;
        }

        .level-ÁÇºËôö {
            background-color: #ff8c00;
            color: white;
        }

        .level-ÂåñÁ•û {
            background-color: #ffd700;
            color: #8b6914;
        }

        .level-ÂÖÉÂ©¥ {
            background-color: #9acd32;
            color: white;
        }

        .level-Áªì‰∏π {
            background-color: #32cd32;
            color: white;
        }

        .level-Á≠ëÂü∫ {
            background-color: #1e90ff;
            color: white;
        }

        .level-ÁÇºÊ∞î {
            background-color: #9370db;
            color: white;
        }

        .level-Âá°‰∫∫ {
            background-color: #6c757d;
            color: white;
        }

        .member-item:last-child {
            border-bottom: none;
        }

        .member-actions {
            display: flex;
            gap: 4px;
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .member-item:hover .member-actions {
            opacity: 1;
        }

        .member-item:hover .position-and-level {
            opacity: 0;
        }

        .btn-xs {
            padding: 2px 6px;
            font-size: 0.65rem;
            border-radius: 8px;
        }

        .btn-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border-radius: 4px;
        }

        .empty-slot {
            color: #6c757d;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 65px;
            border: 1px dashed #dee2e6;
            border-radius: 4px;
            margin-bottom: 4px;
        }

        /* ÈÄâÊâãÊ±†5ÂàóÂ∏ÉÂ±Ä */
        .positions-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }

        @media (max-width: 1400px) {
            .positions-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 992px) {
            .positions-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .positions-container {
                grid-template-columns: 1fr;
            }
        }

        .position-column {
            background: white;
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            min-height: 200px;
        }

        /* ‰ΩçÁΩÆÈ¢úËâ≤ÂÆö‰πâ */
        .position-top {
            background: linear-gradient(135deg, #ff6b6b, #c0392b);
        }

        .position-jungle {
            background: linear-gradient(135deg, #27ae60, #16a085);
        }

        .position-mid {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }

        .position-adc {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .position-support {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .position-title {
            padding: 8px 12px;
            border-radius: 16px;
            margin-bottom: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
            color: white;
        }

        .position-players {
            min-height: 180px;
        }

        .position-players.empty {
            min-height: 0;
        }

        .player-item {
            background: white;
            border-radius: 6px;
            padding: 8px 10px;
            margin-bottom: 6px;
            cursor: grab;
            transition: all 0.2s;
            border: 1px solid #e9ecef;
        }

        .player-item:hover {
            background: #f8f9fa;
            transform: translateX(2px);
        }

        .player-item.dragging {
            opacity: 0.5;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .player-name {
            font-weight: 500;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            max-width: 100%;
        }

        .player-name-text {
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
            font-weight: bold;
            word-break: break-word;
            line-height: 1.2;
        }

        .player-level-pool {
            display: inline-block;
            min-width: 32px;
            height: 20px;
            border-radius: 10px;
            text-align: center;
            line-height: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 5px;
        }

        .player-actions {
            display: flex;
            gap: 4px;
        }

        .add-player-btn {
            width: 100%;
            margin-top: 8px;
            padding: 8px 12px;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, var(--success-color), #146c43);
            border: none;
            color: white;
            border-radius: 6px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .add-player-btn:hover {
            background: linear-gradient(135deg, #146c43, var(--success-color));
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .add-player-btn.no-players {
            margin-top: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
        }

        .add-player-btn.dynamic-position {
            position: relative;
            margin-top: 0;
            top: auto;
            left: auto;
            transform: none;
            width: 100%;
        }

        .clear-btn {
            background-color: transparent;
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .clear-btn:hover {
            background-color: var(--danger-color);
            color: white;
            transform: translateY(-1px);
        }

        .generate-btn {
            background-color: transparent;
            border: 1px solid #9b59b6;
            color: #9b59b6;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .generate-btn:hover {
            background-color: #9b59b6;
            color: white;
            transform: translateY(-1px);
        }

        .save-formation-btn {
            background-color: transparent;
            border: 1px solid #20c997;
            color: #20c997;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .save-formation-btn:hover {
            background-color: #20c997;
            color: white;
            transform: translateY(-1px);
        }

        .schedule-btn {
            background-color: transparent;
            border: 1px solid #fd7e14;
            color: #fd7e14;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .schedule-btn:hover {
            background-color: #fd7e14;
            color: white;
            transform: translateY(-1px);
        }

        .import-export-btn {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .add-team-btn {
            background-color: transparent;
            border: 1px solid var(--success-color);
            color: var(--success-color);
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .add-team-btn:hover {
            background-color: var(--success-color);
            color: white;
            transform: translateY(-1px);
        }

        .sort-select {
            padding: 6px 12px;
            font-size: 0.8rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
            background-color: white;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }

        .tooltip-inner {
            font-size: 0.7rem;
        }

        /* Ëá™ÂÆö‰πâÊ®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .custom-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1050;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .custom-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .custom-modal-content {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .custom-modal.show .custom-modal-content {
            transform: translateY(0);
        }

        .custom-modal-header {
            padding: 20px 24px 0;
            border-bottom: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .custom-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #343a40;
            margin: 0;
        }

        .custom-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6c757d;
            cursor: pointer;
            transition: color 0.2s;
        }

        .custom-modal-close:hover {
            color: #343a40;
        }

        .custom-modal-body {
            padding: 24px;
        }

        .custom-modal-footer {
            padding: 0 24px 24px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .custom-input-group {
            margin-bottom: 20px;
        }

        .custom-input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #495057;
        }

        .custom-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            box-sizing: border-box;
        }

        .custom-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
        }

        .custom-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%236c757d' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 16px;
        }

        .custom-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
        }

        .custom-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .custom-btn-primary:hover {
            background-color: #0b5ed7;
            transform: translateY(-1px);
        }

        .custom-btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .custom-btn-secondary:hover {
            background-color: #5c636a;
            transform: translateY(-1px);
        }

        .player-identity {
            font-size: 0.6rem;
            font-weight: bold;
            padding: 1px 4px;
            border-radius: 4px;
            margin-left: 4px;
        }

        .identity-ÈòüÈïø {
            background-color: #ffd700;
            color: #8b6914;
        }

        .identity-ÈòüÂëò {
            background-color: #6c757d;
            color: white;
        }

        /* ËµõÁ®ãÁïåÈù¢Ê†∑Âºè */
        .schedule-container {
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
        }

        .schedule-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 1px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .schedule-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
        }

        .schedule-match {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .schedule-team {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .schedule-team.home {
            justify-content: flex-start;
        }

        .schedule-team.away {
            justify-content: flex-end;
            flex-direction: row-reverse;
        }

        .schedule-result {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
            margin: 0 12px;
            min-width: 40px;
            text-align: center;
        }

        .result-win {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .result-lose {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
            color: white;
        }

        .result-draw {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: white;
        }

        .schedule-team-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #495057;
            margin: 0 8px;
        }

        .schedule-score {
            font-weight: bold;
            font-size: 1.3rem;
            color: #212529;
            background: white;
            padding: 8px 16px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-width: 80px;
            text-align: center;
        }

        .schedule-datetime {
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            padding: 8px 0;
            border-top: 1px solid #e9ecef;
            margin-top: 8px;
        }

        .schedule-actions {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .schedule-item:hover .schedule-actions {
            opacity: 1;
        }

        .schedule-action-btn {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 6px 10px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .schedule-action-btn.edit {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .schedule-action-btn.edit:hover {
            background: var(--primary-color);
            color: white;
        }

        .schedule-action-btn.delete {
            color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .schedule-action-btn.delete:hover {
            background: var(--danger-color);
            color: white;
        }

        .add-schedule-btn {
            width: 100%;
            margin-top: 16px;
            padding: 12px;
            font-size: 0.9rem;
            background: linear-gradient(135deg, var(--primary-color), #0b5ed7);
            border: none;
            color: white;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .add-schedule-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
        }

        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            gap: 16px;
        }

        .pagination-btn {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>

<body>
    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <div class="content-wrapper">
        <div class="container my-3">
            <div class="main-content">
                <!-- Á¨¨‰∏ÄË°åÔºöÁΩëÈ°µÊ†áÈ¢ò -->
                <div class="text-center mb-3">
                    <h1 class="display-6 fw-bold text-primary">Ëã±ÈõÑËÅîÁõüÈòµÂÆπÁ≥ªÁªü</h1>
                </div>

                <!-- ÂØºÂÖ•ÂØºÂá∫Âå∫Âüü -->
                <div class="import-export-area">
                    <button class="btn btn-success import-export-btn" id="importBtn">
                        ÂØºÂÖ•ÈòµÂÆπ
                    </button>
                    <button class="btn btn-primary import-export-btn" id="exportBtn">
                        ÂØºÂá∫ÈòµÂÆπ
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>

                <!-- ÈòµÂÆπÂàóË°®Âå∫Âüü -->
                <div class="formation-list-area">
                    <div class="area-header">
                        <div class="area-title">
                            <h5 class="mb-0 fw-bold" style="font-size: 1rem;">üìã ÈòµÂÆπÂàóË°®</h5>
                        </div>
                    </div>
                    <div class="formation-tags" id="formationTags">
                        <!-- ÈòµÂÆπÊ†áÁ≠æÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>

                <!-- Èòü‰ºçÂå∫Âüü -->
                <div class="team-area">
                    <div class="area-header">
                        <div class="area-title">
                            <h5 class="mb-0 fw-bold" style="font-size: 1rem;">üèÜ Èòü‰ºçÈòµÂÆπÔºàÊØèÈòü5‰∫∫Ôºâ</h5>
                        </div>
                        <div class="area-actions">
                            <select class="sort-select" id="sortSelect">
                                <option value="none">Êó†ÊéíÂ∫è</option>
                                <option value="position">‰ΩçÁΩÆÊéíÂ∫è</option>
                            </select>
                            <button class="btn add-team-btn" id="addTeamBtn">
                                ‚ûï Ê∑ªÂä†Èòü‰ºç
                            </button>
                            <button class="btn save-formation-btn" id="saveFormationBtn">
                                üíæ ‰øùÂ≠òÈòµÂÆπ
                            </button>
                            <button class="btn schedule-btn" id="scheduleBtn">
                                üìÖ ËµõÁ®ã
                            </button>
                            <button class="btn generate-btn" id="generateTeamBtn">
                                ‚ö° ÁîüÊàêÈòµÂÆπ
                            </button>
                            <button class="btn clear-btn" id="clearAllBtn">
                                üóëÔ∏è Ê∏ÖÁ©∫
                            </button>
                        </div>
                    </div>

                    <!-- Èòü‰ºçÂàóË°® -->
                    <div class="teams-container" id="teamsContainer">
                        <div class="loading">Ê≠£Âú®Âä†ËΩΩÈòü‰ºçÊï∞ÊçÆ...</div>
                    </div>
                </div>

                <!-- ÈÄâÊâãÊ±†Âå∫Âüü -->
                <div class="player-pool-area">
                    <div class="area-header">
                        <div class="area-title">
                            <h5 class="mb-0 fw-bold" style="font-size: 1rem;">üë• ÈÄâÊâãÊ±†</h5>
                        </div>
                    </div>

                    <!-- 5ÂàóÈÄâÊâãÂ∏ÉÂ±Ä -->
                    <div class="positions-container" id="positionsContainer">
                        <div class="loading">Ê≠£Âú®Âä†ËΩΩÈÄâÊâãÊï∞ÊçÆ...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Â∫ïÈÉ®ÁâàÊùÉ‰ø°ÊÅØ -->
    <div class="copyright">
        <div class="container">
            <p class="mb-0" style="font-size: 0.9rem;">Developed With DeepSeek„ÄÅBootstrap</p>
        </div>
    </div>

    <!-- Ëá™ÂÆö‰πâÊ®°ÊÄÅÊ°Ü -->
    <div class="custom-modal" id="customModal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h4 class="custom-modal-title" id="modalTitle">Ê†áÈ¢ò</h4>
                <button type="button" class="custom-modal-close" id="modalCloseBtn">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div class="custom-input-group">
                    <label class="custom-input-label" id="inputLabel">ËØ∑ËæìÂÖ•ÂÜÖÂÆπÔºö</label>
                    <input type="text" class="custom-input" id="modalInput" placeholder="ËæìÂÖ•ÂÜÖÂÆπ...">
                </div>
                <div class="custom-input-group" id="selectGroup" style="display: none;">
                    <label class="custom-input-label" id="selectLabel">ËØ∑ÈÄâÊã©Ôºö</label>
                    <select class="custom-select" id="modalSelect">
                        <option value="Âá°‰∫∫">Âá°‰∫∫</option>
                        <option value="ÁÇºÊ∞î">ÁÇºÊ∞î</option>
                        <option value="Á≠ëÂü∫">Á≠ëÂü∫</option>
                        <option value="Áªì‰∏π">Áªì‰∏π</option>
                        <option value="ÂÖÉÂ©¥">ÂÖÉÂ©¥</option>
                        <option value="ÂåñÁ•û">ÂåñÁ•û</option>
                        <option value="ÁÇºËôö">ÁÇºËôö</option>
                        <option value="Âêà‰Ωì">Âêà‰Ωì</option>
                        <option value="Â§ß‰πò">Â§ß‰πò</option>
                    </select>
                </div>
                <div class="custom-input-group" id="identityGroup" style="display: none;">
                    <label class="custom-input-label" id="identityLabel">ËØ∑ÈÄâÊã©Ë∫´‰ªΩÔºö</label>
                    <select class="custom-select" id="modalIdentity">
                        <option value="ÈòüÂëò">ÈòüÂëò</option>
                        <option value="ÈòüÈïø">ÈòüÈïø</option>
                    </select>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button type="button" class="custom-btn custom-btn-secondary" id="modalCancelBtn">ÂèñÊ∂à</button>
                <button type="button" class="custom-btn custom-btn-primary" id="modalConfirmBtn">Á°ÆËÆ§</button>
            </div>
        </div>
    </div>

    <!-- ËµõÁ®ãÊ®°ÊÄÅÊ°Ü -->
    <div class="custom-modal" id="scheduleModal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h4 class="custom-modal-title">üìÖ ËµõÁ®ãÁÆ°ÁêÜ</h4>
                <button type="button" class="custom-modal-close" id="scheduleModalCloseBtn">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div class="schedule-container" id="scheduleContainer">
                    <!-- ËµõÁ®ãÈ°πÁõÆÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                <div class="pagination-container" id="paginationContainer">
                    <!-- ÂàÜÈ°µÊéß‰ª∂Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÁîüÊàê -->
                </div>
                <button class="btn add-schedule-btn" id="addScheduleBtn">
                    ‚ûï Ê∑ªÂä†ÂØπÈòµ
                </button>
            </div>
            <div class="custom-modal-footer">
                <button type="button" class="custom-btn custom-btn-secondary" id="scheduleModalCancelBtn">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <script>
        // Á≠âÂæÖDOMÂÆåÂÖ®Âä†ËΩΩ
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, initializing app...');

            // ÈªòËÆ§Êï∞ÊçÆ
            const defaultTeams = [
                { id: 1, name: "1Èòü", color: "#dc3545", members: [] },
                { id: 2, name: "2Èòü", color: "#0d6efd", members: [] },
                { id: 3, name: "3Èòü", color: "#198754", members: [] },
                { id: 4, name: "4Èòü", color: "#fd7e14", members: [] },
                { id: 5, name: "5Èòü", color: "#6f42c1", members: [] },
                { id: 6, name: "6Èòü", color: "#20c997", members: [] },
                { id: 7, name: "7Èòü", color: "#e83e8c", members: [] }
            ];

            const defaultPlayersByPosition = {
                "‰∏äÂçï": [
                    { id: 1, name: "Â∞èÊçè", position: "‰∏äÂçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 2, name: "Á±≥Âãí", position: "‰∏äÂçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 3, name: "ÂëÜÂëÜ", position: "‰∏äÂçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 4, name: "ÂÆ∏ÂÆá", position: "‰∏äÂçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 5, name: "Á••È∫ü", position: "‰∏äÂçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 6, name: "Langx", position: "‰∏äÂçï", level: "ÂÖÉÂ©¥", identity: "ÈòüÈïø" },
                    { id: 7, name: "957", position: "‰∏äÂçï", level: "ÂÖÉÂ©¥", identity: "ÈòüÈïø" }
                ],
                "ÊâìÈáé": [
                    { id: 8, name: "Ëµµ‰øäÊó•", position: "ÊâìÈáé", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 9, name: "ÁÆ°Ê≥ΩÂÖÉ", position: "ÊâìÈáé", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 10, name: "ÂèãÊµ©", position: "ÊâìÈáé", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 11, name: "Âº†Á°ï", position: "ÊâìÈáé", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 12, name: "‰πê‰πê", position: "ÊâìÈáé", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 13, name: "Fireloli", position: "ÊâìÈáé", level: "ÂÖÉÂ©¥", identity: "ÈòüÈïø" },
                    { id: 14, name: "Hacker", position: "ÊâìÈáé", level: "ÂÖÉÂ©¥", identity: "ÈòüÈïø" }
                ],
                "‰∏≠Âçï": [
                    { id: 15, name: "‰πòÈ£éÂÑø", position: "‰∏≠Âçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 16, name: "ÁéãÊ∑û", position: "‰∏≠Âçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 17, name: "Ning", position: "‰∏≠Âçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 18, name: "Â∞è‰ºû", position: "‰∏≠Âçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 19, name: "Zonic", position: "‰∏≠Âçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 20, name: "Doby", position: "‰∏≠Âçï", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 21, name: "Xiye", position: "‰∏≠Âçï", level: "ÂÖÉÂ©¥", identity: "ÈòüÈïø" }
                ],
                "Â∞ÑÊâã": [
                    { id: 22, name: "ÂÆùËìù", position: "Â∞ÑÊâã", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 23, name: "ÊØõÊØõ", position: "Â∞ÑÊâã", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 24, name: "Suki", position: "Â∞ÑÊâã", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 25, name: "ÊÄÄÂçó", position: "Â∞ÑÊâã", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 26, name: "Áû≥Â§ï", position: "Â∞ÑÊâã", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 27, name: "Mage", position: "Â∞ÑÊâã", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 28, name: "Èõ®Âá°", position: "Â∞ÑÊâã", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" }
                ],
                "ËæÖÂä©": [
                    { id: 29, name: "ÂçÅÊúà", position: "ËæÖÂä©", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 30, name: "Âë®Êï¢Êï¢", position: "ËæÖÂä©", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 31, name: "ÈòøËäô", position: "ËæÖÂä©", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 32, name: "Kinko", position: "ËæÖÂä©", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 33, name: "Cryin", position: "ËæÖÂä©", level: "Á≠ëÂü∫", identity: "ÈòüÂëò" },
                    { id: 34, name: "Pyl", position: "ËæÖÂä©", level: "ÂÖÉÂ©¥", identity: "ÈòüÈïø" },
                    { id: 35, name: "Doinb", position: "ËæÖÂä©", level: "ÂÖÉÂ©¥", identity: "ÈòüÈïø" }
                ]
            };

            // Á≠âÁ∫ßÊùÉÈáçÊò†Â∞ÑÔºàÁî®‰∫éËÆ°ÁÆóÈòü‰ºçÂÆûÂäõÔºâ
            const levelWeights = {
                "Âá°‰∫∫": 1,
                "ÁÇºÊ∞î": 2,
                "Á≠ëÂü∫": 3,
                "Áªì‰∏π": 4,
                "ÂÖÉÂ©¥": 5,
                "ÂåñÁ•û": 6,
                "ÁÇºËôö": 7,
                "Âêà‰Ωì": 8,
                "Â§ß‰πò": 9
            };

            // ‰ΩçÁΩÆÁÆÄÂÜôÊò†Â∞Ñ
            const positionAbbr = {
                "‰∏äÂçï": "‰∏ä",
                "ÊâìÈáé": "Èáé",
                "‰∏≠Âçï": "‰∏≠",
                "Â∞ÑÊâã": "Â∞Ñ",
                "ËæÖÂä©": "ËæÖ"
            };

            // ‰ΩçÁΩÆÈ°∫Â∫è
            const positionOrder = ["‰∏äÂçï", "ÊâìÈáé", "‰∏≠Âçï", "Â∞ÑÊâã", "ËæÖÂä©"];

            // ÂΩìÂâçÊï∞ÊçÆ
            let teams = JSON.parse(JSON.stringify(defaultTeams));
            let playersByPosition = JSON.parse(JSON.stringify(defaultPlayersByPosition));

            // ÈòµÂÆπÂàóË°®Êï∞ÊçÆ
            let formations = [];
            let currentFormationId = null;
            let nextFormationId = 1;

            // ÊéíÂ∫èÊñπÂºè
            let sortMethod = 'none'; // 'none' Êàñ 'position'

            // ËµõÁ®ãÊï∞ÊçÆ
            let schedules = [];
            let nextScheduleId = 1;

            // ÂàÜÈ°µÁõ∏ÂÖ≥
            let currentPage = 1;
            const itemsPerPage = 5;

            // ÂØºÂÖ•Êï∞ÊçÆÂ§á‰ªΩ
            let importedData = null;

            const positionColors = {
                "‰∏äÂçï": "position-top",
                "ÊâìÈáé": "position-jungle",
                "‰∏≠Âçï": "position-mid",
                "Â∞ÑÊâã": "position-adc",
                "ËæÖÂä©": "position-support"
            };

            let nextPlayerId = 36;
            let nextTeamId = 8;

            // Ëá™ÂÆö‰πâÊ®°ÊÄÅÊ°ÜÁõ∏ÂÖ≥ÂèòÈáè
            let modalResolve = null;
            let modalReject = null;
            const modal = document.getElementById('customModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalInput = document.getElementById('modalInput');
            const modalSelect = document.getElementById('modalSelect');
            const modalIdentity = document.getElementById('modalIdentity');
            const inputLabel = document.getElementById('inputLabel');
            const selectGroup = document.getElementById('selectGroup');
            const identityGroup = document.getElementById('identityGroup');
            const selectLabel = document.getElementById('selectLabel');
            const identityLabel = document.getElementById('identityLabel');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const modalCancelBtn = document.getElementById('modalCancelBtn');
            const modalConfirmBtn = document.getElementById('modalConfirmBtn');

            // ËµõÁ®ãÊ®°ÊÄÅÊ°ÜÁõ∏ÂÖ≥ÂèòÈáè
            const scheduleModal = document.getElementById('scheduleModal');
            const scheduleModalCloseBtn = document.getElementById('scheduleModalCloseBtn');
            const scheduleModalCancelBtn = document.getElementById('scheduleModalCancelBtn');
            const scheduleContainer = document.getElementById('scheduleContainer');
            const paginationContainer = document.getElementById('paginationContainer');
            const addScheduleBtn = document.getElementById('addScheduleBtn');

            // Ëá™ÂÆö‰πâÊèêÁ§∫Ê°ÜÂáΩÊï∞
            function customPrompt(title, label, defaultValue = '', type = 'text') {
                return new Promise((resolve, reject) => {
                    modalResolve = resolve;
                    modalReject = reject;

                    modalTitle.textContent = title;
                    inputLabel.textContent = label;
                    modalInput.value = defaultValue;

                    // Ê†πÊçÆÁ±ªÂûãÊòæÁ§∫/ÈöêËóè‰∏çÂêåÁöÑËæìÂÖ•Êéß‰ª∂
                    if (type === 'text') {
                        modalInput.style.display = 'block';
                        selectGroup.style.display = 'none';
                        identityGroup.style.display = 'none';
                    } else if (type === 'select') {
                        modalInput.style.display = 'none';
                        selectGroup.style.display = 'block';
                        identityGroup.style.display = 'none';
                        modalSelect.value = defaultValue;
                    } else if (type === 'identity') {
                        modalInput.style.display = 'none';
                        selectGroup.style.display = 'none';
                        identityGroup.style.display = 'block';
                        modalIdentity.value = defaultValue;
                    }

                    modal.classList.add('show');
                    modalInput.focus();
                });
            }

            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            function closeModal() {
                modal.classList.remove('show');
                if (modalReject) {
                    modalReject('Áî®Êà∑ÂèñÊ∂à');
                    modalResolve = null;
                    modalReject = null;
                }
            }

            // Á°ÆËÆ§Ê®°ÊÄÅÊ°ÜËæìÂÖ•
            function confirmModal() {
                let value;
                if (modalInput.style.display === 'block') {
                    value = modalInput.value.trim();
                } else if (selectGroup.style.display === 'block') {
                    value = modalSelect.value;
                } else if (identityGroup.style.display === 'block') {
                    value = modalIdentity.value;
                }

                if (modalResolve) {
                    modalResolve(value);
                    modalResolve = null;
                    modalReject = null;
                }
                closeModal();
            }

            // ÁªëÂÆöÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
            modalCloseBtn.addEventListener('click', closeModal);
            modalCancelBtn.addEventListener('click', closeModal);
            modalConfirmBtn.addEventListener('click', confirmModal);

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            modal.addEventListener('click', function (event) {
                if (event.target === modal) {
                    closeModal();
                }
            });

            // ÊåâEnterÁ°ÆËÆ§ÔºåÊåâEscÂèñÊ∂à
            modalInput.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    confirmModal();
                } else if (event.key === 'Escape') {
                    closeModal();
                }
            });

            modalSelect.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    confirmModal();
                } else if (event.key === 'Escape') {
                    closeModal();
                }
            });

            modalIdentity.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    confirmModal();
                } else if (event.key === 'Escape') {
                    closeModal();
                }
            });

            // ËµõÁ®ãÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
            scheduleModalCloseBtn.addEventListener('click', closeScheduleModal);
            scheduleModalCancelBtn.addEventListener('click', closeScheduleModal);
            addScheduleBtn.addEventListener('click', addSchedule);

            // ÁÇπÂáªËµõÁ®ãÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            scheduleModal.addEventListener('click', function (event) {
                if (event.target === scheduleModal) {
                    closeScheduleModal();
                }
            });

            // ÂÖ≥Èó≠ËµõÁ®ãÊ®°ÊÄÅÊ°Ü
            function closeScheduleModal() {
                scheduleModal.classList.remove('show');
            }

            // ÊâìÂºÄËµõÁ®ãÊ®°ÊÄÅÊ°Ü
            function openScheduleModal() {
                currentPage = 1;
                renderSchedules();
                scheduleModal.classList.add('show');
            }

            // ÂàùÂßãÂåñÂ∫îÁî®
            function initApp() {
                console.log('Initializing app...');
                renderTeams();
                renderPlayerPool();
                renderFormationTags();
                bindEvents();
                console.log('App initialized successfully');
            }

            // Ê∏≤ÊüìÈòü‰ºç
            function renderTeams() {
                const teamsContainer = document.getElementById('teamsContainer');
                teamsContainer.innerHTML = '';

                teams.forEach(team => {
                    const teamCard = document.createElement('div');
                    teamCard.className = 'team-card';
                    teamCard.dataset.teamId = team.id;
                    teamCard.style.borderTop = `4px solid ${team.color}`;

                    // Èòü‰ºçÂ§¥ÈÉ®
                    const teamHeader = document.createElement('div');
                    teamHeader.className = 'team-header';

                    const teamInfo = document.createElement('div');
                    teamInfo.className = 'team-info';

                    const teamNumber = document.createElement('div');
                    teamNumber.className = 'team-number';
                    teamNumber.textContent = team.id;

                    const teamName = document.createElement('span');
                    teamName.className = 'team-name';
                    teamName.textContent = team.name;

                    const teamActions = document.createElement('div');
                    teamActions.className = 'team-actions';

                    const editBtn = document.createElement('button');
                    editBtn.className = 'btn btn-outline-primary btn-xs btn-icon';
                    editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                    editBtn.title = '‰øÆÊîπÈòü‰ºçÂêçÁß∞';
                    editBtn.onclick = () => editTeamName(team.id);

                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'btn btn-outline-danger btn-xs btn-icon';
                    removeBtn.innerHTML = '<i class="fas fa-trash"></i>';
                    removeBtn.title = 'Âà†Èô§Èòü‰ºç';
                    removeBtn.onclick = () => removeTeam(team.id);

                    teamInfo.appendChild(teamNumber);
                    teamInfo.appendChild(teamName);
                    teamActions.appendChild(editBtn);
                    teamActions.appendChild(removeBtn);
                    teamHeader.appendChild(teamInfo);
                    teamHeader.appendChild(teamActions);

                    // Èòü‰ºçÊàêÂëòÂå∫Âüü
                    const teamMembers = document.createElement('div');
                    teamMembers.className = 'team-members';

                    // Ê†πÊçÆÊéíÂ∫èÊñπÂºèÊ∏≤ÊüìÊàêÂëò
                    let membersToRender = [...team.members];

                    if (sortMethod === 'position') {
                        // ‰ΩçÁΩÆÊéíÂ∫è
                        membersToRender.sort((a, b) => {
                            return positionOrder.indexOf(a.position) - positionOrder.indexOf(b.position);
                        });
                    }
                    // Êó†ÊéíÂ∫èÔºö‰øùÊåÅÂéüÊúâÈ°∫Â∫è

                    // Ê∏ÖÁ©∫Áé∞ÊúâÊàêÂëòÊòæÁ§∫
                    teamMembers.innerHTML = '';

                    // ÊòæÁ§∫Áé∞ÊúâÊàêÂëò
                    if (membersToRender.length === 0) {
                        // Â¶ÇÊûúÊ≤°ÊúâÊàêÂëòÔºåÊòæÁ§∫5‰∏™Á©∫‰Ωç
                        for (let i = 0; i < 5; i++) {
                            const emptySlot = document.createElement('div');
                            emptySlot.className = 'empty-slot';
                            emptySlot.textContent = 'Á©∫‰Ωç';
                            emptySlot.dataset.position = positionOrder[i];
                            teamMembers.appendChild(emptySlot);
                        }
                    } else {
                        // ÊòæÁ§∫Áé∞ÊúâÊàêÂëò
                        membersToRender.forEach(member => {
                            const memberItem = createMemberItem(member, team.id);
                            teamMembers.appendChild(memberItem);
                        });

                        // Ë°•ÂÖÖÁ©∫‰Ωç
                        const remainingSlots = 5 - membersToRender.length;
                        for (let i = 0; i < remainingSlots; i++) {
                            const emptySlot = document.createElement('div');
                            emptySlot.className = 'empty-slot';
                            emptySlot.textContent = 'Á©∫‰Ωç';
                            emptySlot.dataset.position = positionOrder[membersToRender.length + i];
                            teamMembers.appendChild(emptySlot);
                        }
                    }

                    teamCard.appendChild(teamHeader);
                    teamCard.appendChild(teamMembers);
                    teamsContainer.appendChild(teamCard);
                });

                // ÂêØÁî®ÊãñÊîæÂäüËÉΩ
                enableDragAndDrop();
            }

            // ÂàõÂª∫ÊàêÂëòÈ°π
            function createMemberItem(member, teamId) {
                const memberItem = document.createElement('div');
                memberItem.className = 'member-item';
                memberItem.draggable = true;
                memberItem.dataset.playerId = member.id;
                memberItem.dataset.position = member.position;
                memberItem.dataset.teamId = teamId;

                const memberLeft = document.createElement('div');
                memberLeft.className = 'member-left';

                const playerNameContainer = document.createElement('div');
                playerNameContainer.className = 'player-name-container';

                const playerNameStatic = document.createElement('div');
                playerNameStatic.className = 'player-name-static';
                //playerNameStatic.textContent = member.name;

                const playerNameStatichref = document.createElement('a');
                playerNameStatichref.className = 'player-name-static-href';
                playerNameStatichref.href = "https://sakura-jikage.github.io/notebookhtmlproject/palyer_info_sys/index.html?player=" + member.name.toLowerCase();
                playerNameStatichref.textContent = member.name;
                playerNameStatic.appendChild(playerNameStatichref);

                // Ê∑ªÂä†Ë∫´‰ªΩÊ†áËØÜ
                if (member.identity === 'ÈòüÈïø') {
                    const identityTag = document.createElement('span');
                    identityTag.className = `player-identity identity-${member.identity}`;
                    identityTag.textContent = member.identity;
                    playerNameStatic.appendChild(identityTag);
                }

                playerNameContainer.appendChild(playerNameStatic);
                memberLeft.appendChild(playerNameContainer);

                const memberRight = document.createElement('div');
                memberRight.className = 'member-right';

                const positionAndLevel = document.createElement('div');
                positionAndLevel.className = 'position-and-level';

                const positionTag = document.createElement('span');
                positionTag.className = 'position-tag';
                positionTag.style.backgroundColor = getPositionColor(member.position);
                positionTag.textContent = positionAbbr[member.position];

                const playerLevel = document.createElement('span');
                playerLevel.className = `player-level level-${member.level}`;
                playerLevel.textContent = member.level;

                positionAndLevel.appendChild(positionTag);
                positionAndLevel.appendChild(playerLevel);

                const memberActions = document.createElement('div');
                memberActions.className = 'member-actions';

                const levelBtn = document.createElement('button');
                levelBtn.className = 'btn btn-outline-warning btn-xs btn-icon';
                levelBtn.innerHTML = '<i class="fas fa-chart-line"></i>';
                levelBtn.title = '‰øÆÊîπÁ≠âÁ∫ß';
                levelBtn.onclick = (e) => {
                    e.stopPropagation();
                    changePlayerLevel(member.id, teamId);
                };

                const identityBtn = document.createElement('button');
                identityBtn.className = 'btn btn-outline-info btn-xs btn-icon';
                identityBtn.innerHTML = '<i class="fas fa-user-tie"></i>';
                identityBtn.title = member.identity === 'ÈòüÈïø' ? 'ÂèñÊ∂àÈòüÈïø' : 'ÊåáÂÆö‰∏∫ÈòüÈïø';
                identityBtn.onclick = (e) => {
                    e.stopPropagation();
                    togglePlayerIdentity(member.id, teamId);
                };

                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn btn-outline-danger btn-xs btn-icon';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.title = 'ÁßªÈô§ÈÄâÊâã';
                removeBtn.onclick = (e) => {
                    e.stopPropagation();
                    removePlayerFromTeam(member.id, teamId);
                };

                memberActions.appendChild(identityBtn);
                memberActions.appendChild(levelBtn);
                memberActions.appendChild(removeBtn);

                memberRight.appendChild(positionAndLevel);
                memberRight.appendChild(memberActions);

                memberItem.appendChild(memberLeft);
                memberItem.appendChild(memberRight);

                return memberItem;
            }

            // Ëé∑Âèñ‰ΩçÁΩÆÈ¢úËâ≤
            function getPositionColor(position) {
                const colors = {
                    "‰∏äÂçï": "#dc3545",
                    "ÊâìÈáé": "#198754",
                    "‰∏≠Âçï": "#0d6efd",
                    "Â∞ÑÊâã": "#6f42c1",
                    "ËæÖÂä©": "#fd7e14"
                };
                return colors[position] || "#6c757d";
            }

            // Ê∏≤ÊüìÈÄâÊâãÊ±†
            function renderPlayerPool() {
                const positionsContainer = document.getElementById('positionsContainer');
                positionsContainer.innerHTML = '';

                positionOrder.forEach(position => {
                    const positionColumn = document.createElement('div');
                    positionColumn.className = 'position-column';

                    const positionTitle = document.createElement('div');
                    positionTitle.className = `position-title ${positionColors[position]}`;
                    positionTitle.textContent = position;

                    const positionPlayers = document.createElement('div');
                    positionPlayers.className = 'position-players';
                    positionPlayers.dataset.position = position;

                    const players = playersByPosition[position] || [];
                    if (players.length === 0) {
                        positionPlayers.classList.add('empty');
                    }

                    players.forEach(player => {
                        const playerItem = createPlayerItem(player);
                        positionPlayers.appendChild(playerItem);
                    });

                    // Ê∑ªÂä†ÈÄâÊâãÊåâÈíÆ
                    const addPlayerBtn = document.createElement('button');
                    addPlayerBtn.className = players.length === 0 ? 'add-player-btn no-players' : 'add-player-btn dynamic-position';
                    addPlayerBtn.innerHTML = '<i class="fas fa-plus"></i> Ê∑ªÂä†ÈÄâÊâã';
                    addPlayerBtn.onclick = () => addPlayerToPosition(position);

                    positionColumn.appendChild(positionTitle);
                    positionColumn.appendChild(positionPlayers);
                    positionColumn.appendChild(addPlayerBtn);
                    positionsContainer.appendChild(positionColumn);
                });

                // ÂêØÁî®ÊãñÊîæÂäüËÉΩ
                enableDragAndDrop();
            }

            // ÂàõÂª∫ÈÄâÊâãÈ°π
            function createPlayerItem(player) {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.draggable = true;
                playerItem.dataset.playerId = player.id;
                playerItem.dataset.position = player.position;

                const playerHeader = document.createElement('div');
                playerHeader.className = 'player-header';

                const playerName = document.createElement('div');
                playerName.className = 'player-name';

                const playerNameText = document.createElement('span');
                playerNameText.className = 'player-name-text';
                //playerNameText.textContent = player.name;

                const playerNameStatichref = document.createElement('a');
                playerNameStatichref.className = 'player-name-static-href';
                playerNameStatichref.href = "https://sakura-jikage.github.io/notebookhtmlproject/palyer_info_sys/index.html?player=" + player.name.toLowerCase();
                playerNameStatichref.textContent = player.name;
                playerNameText.appendChild(playerNameStatichref);

                const playerLevel = document.createElement('span');
                playerLevel.className = `player-level-pool level-${player.level}`;
                playerLevel.textContent = player.level;

                // Ê∑ªÂä†Ë∫´‰ªΩÊ†áËØÜ
                if (player.identity === 'ÈòüÈïø') {
                    const identityTag = document.createElement('span');
                    identityTag.className = `player-identity identity-${player.identity}`;
                    identityTag.textContent = player.identity;
                    playerNameText.appendChild(identityTag);
                }

                playerName.appendChild(playerNameText);
                playerName.appendChild(playerLevel);

                const playerActions = document.createElement('div');
                playerActions.className = 'player-actions';

                const levelBtn = document.createElement('button');
                levelBtn.className = 'btn btn-outline-warning btn-xs btn-icon';
                levelBtn.innerHTML = '<i class="fas fa-chart-line"></i>';
                levelBtn.title = '‰øÆÊîπÁ≠âÁ∫ß';
                levelBtn.onclick = (e) => {
                    e.stopPropagation();
                    changePlayerLevel(player.id);
                };

                const identityBtn = document.createElement('button');
                identityBtn.className = 'btn btn-outline-info btn-xs btn-icon';
                identityBtn.innerHTML = '<i class="fas fa-user-tie"></i>';
                identityBtn.title = player.identity === 'ÈòüÈïø' ? 'ÂèñÊ∂àÈòüÈïø' : 'ÊåáÂÆö‰∏∫ÈòüÈïø';
                identityBtn.onclick = (e) => {
                    e.stopPropagation();
                    togglePlayerIdentity(player.id);
                };

                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn btn-outline-danger btn-xs btn-icon';
                removeBtn.innerHTML = '<i class="fas fa-times"></i>';
                removeBtn.title = 'Âà†Èô§ÈÄâÊâã';
                removeBtn.onclick = (e) => {
                    e.stopPropagation();
                    removePlayerFromPool(player.id, player.position);
                };

                playerActions.appendChild(identityBtn);
                playerActions.appendChild(levelBtn);
                playerActions.appendChild(removeBtn);

                playerHeader.appendChild(playerName);
                playerHeader.appendChild(playerActions);

                playerItem.appendChild(playerHeader);

                return playerItem;
            }

            // Ê∏≤ÊüìÈòµÂÆπÊ†áÁ≠æ
            function renderFormationTags() {
                const formationTags = document.getElementById('formationTags');
                formationTags.innerHTML = '';

                formations.forEach(formation => {
                    const tag = document.createElement('div');
                    tag.className = `formation-tag ${formation.id === currentFormationId ? 'active' : ''}`;
                    tag.dataset.formationId = formation.id;

                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'formation-tag-name';
                    nameSpan.textContent = formation.name;

                    const actions = document.createElement('div');
                    actions.className = 'formation-tag-actions';

                    const editBtn = document.createElement('button');
                    editBtn.className = 'formation-tag-btn';
                    editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                    editBtn.title = '‰øÆÊîπÂêçÁß∞';
                    editBtn.onclick = (e) => {
                        e.stopPropagation();
                        editFormationName(formation.id);
                    };

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'formation-tag-btn';
                    deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                    deleteBtn.title = 'Âà†Èô§ÈòµÂÆπ';
                    deleteBtn.onclick = (e) => {
                        e.stopPropagation();
                        deleteFormation(formation.id);
                    };

                    actions.appendChild(editBtn);
                    actions.appendChild(deleteBtn);

                    tag.appendChild(nameSpan);
                    tag.appendChild(actions);

                    tag.addEventListener('click', () => {
                        switchFormation(formation.id);
                    });

                    formationTags.appendChild(tag);
                });
            }

            // Ê∏≤ÊüìËµõÁ®ã
            function renderSchedules() {
                scheduleContainer.innerHTML = '';

                if (schedules.length === 0) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'text-center text-muted py-4';
                    emptyMessage.textContent = 'ÊöÇÊó†ËµõÁ®ãÂÆâÊéí';
                    scheduleContainer.appendChild(emptyMessage);
                    renderPagination();
                    return;
                }

                // ËÆ°ÁÆóÂàÜÈ°µ
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = Math.min(startIndex + itemsPerPage, schedules.length);
                const currentSchedules = schedules.slice(startIndex, endIndex);

                currentSchedules.forEach(schedule => {
                    const scheduleItem = document.createElement('div');
                    scheduleItem.className = 'schedule-item';

                    // Ëß£ÊûêÊØîÂàÜ
                    const [homeScore, awayScore] = schedule.score.split('-').map(Number);

                    // Á°ÆÂÆöËÉúË¥üÁªìÊûú
                    let homeResult, awayResult;
                    if (homeScore > awayScore) {
                        homeResult = 'win';
                        awayResult = 'lose';
                    } else if (homeScore < awayScore) {
                        homeResult = 'lose';
                        awayResult = 'win';
                    } else {
                        homeResult = 'draw';
                        awayResult = 'draw';
                    }

                    // ÂØπÈòµ‰ø°ÊÅØ
                    const scheduleMatch = document.createElement('div');
                    scheduleMatch.className = 'schedule-match';

                    // ‰∏ªÈòü‰ø°ÊÅØ
                    const homeTeam = document.createElement('div');
                    homeTeam.className = 'schedule-team home';

                    const homeResultDiv = document.createElement('div');
                    homeResultDiv.className = `schedule-result result-${homeResult}`;
                    homeResultDiv.textContent = homeResult === 'win' ? 'ËÉú' : homeResult === 'lose' ? 'Ë¥ü' : 'Âπ≥';

                    const homeName = document.createElement('div');
                    homeName.className = 'schedule-team-name';
                    homeName.textContent = schedule.team1;

                    homeTeam.appendChild(homeResultDiv);
                    homeTeam.appendChild(homeName);

                    // ÊØîÂàÜ
                    const scoreDiv = document.createElement('div');
                    scoreDiv.className = 'schedule-score';
                    scoreDiv.textContent = schedule.score;

                    // ÂÆ¢Èòü‰ø°ÊÅØ
                    const awayTeam = document.createElement('div');
                    awayTeam.className = 'schedule-team away';

                    const awayResultDiv = document.createElement('div');
                    awayResultDiv.className = `schedule-result result-${awayResult}`;
                    awayResultDiv.textContent = awayResult === 'win' ? 'ËÉú' : awayResult === 'lose' ? 'Ë¥ü' : 'Âπ≥';

                    const awayName = document.createElement('div');
                    awayName.className = 'schedule-team-name';
                    awayName.textContent = schedule.team2;

                    awayTeam.appendChild(awayName);
                    awayTeam.appendChild(awayResultDiv);

                    scheduleMatch.appendChild(homeTeam);
                    scheduleMatch.appendChild(scoreDiv);
                    scheduleMatch.appendChild(awayTeam);

                    // ÊØîËµõÊó∂Èó¥
                    const datetimeDiv = document.createElement('div');
                    datetimeDiv.className = 'schedule-datetime';
                    datetimeDiv.textContent = schedule.datetime;

                    // Êìç‰ΩúÊåâÈíÆ
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'schedule-actions';

                    const editBtn = document.createElement('button');
                    editBtn.className = 'schedule-action-btn edit';
                    editBtn.innerHTML = '<i class="fas fa-edit"></i> ÁºñËæë';
                    editBtn.onclick = () => editSchedule(schedule.id);

                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'schedule-action-btn delete';
                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i> Âà†Èô§';
                    deleteBtn.onclick = () => deleteSchedule(schedule.id);

                    actionsDiv.appendChild(editBtn);
                    actionsDiv.appendChild(deleteBtn);

                    scheduleItem.appendChild(scheduleMatch);
                    scheduleItem.appendChild(datetimeDiv);
                    scheduleItem.appendChild(actionsDiv);

                    scheduleContainer.appendChild(scheduleItem);
                });

                renderPagination();
            }

            // Ê∏≤ÊüìÂàÜÈ°µÊéß‰ª∂
            function renderPagination() {
                paginationContainer.innerHTML = '';

                if (schedules.length <= itemsPerPage) {
                    return;
                }

                const totalPages = Math.ceil(schedules.length / itemsPerPage);

                const prevBtn = document.createElement('button');
                prevBtn.className = 'pagination-btn';
                prevBtn.innerHTML = '‚Äπ ‰∏ä‰∏ÄÈ°µ';
                prevBtn.disabled = currentPage === 1;
                prevBtn.onclick = () => {
                    if (currentPage > 1) {
                        currentPage--;
                        renderSchedules();
                    }
                };

                const nextBtn = document.createElement('button');
                nextBtn.className = 'pagination-btn';
                nextBtn.innerHTML = '‰∏ã‰∏ÄÈ°µ ‚Ä∫';
                nextBtn.disabled = currentPage === totalPages;
                nextBtn.onclick = () => {
                    if (currentPage < totalPages) {
                        currentPage++;
                        renderSchedules();
                    }
                };

                const infoDiv = document.createElement('div');
                infoDiv.className = 'pagination-info';
                infoDiv.textContent = `Á¨¨ ${currentPage} È°µÔºåÂÖ± ${totalPages} È°µ`;

                paginationContainer.appendChild(prevBtn);
                paginationContainer.appendChild(infoDiv);
                paginationContainer.appendChild(nextBtn);
            }

            // Ê∑ªÂä†ËµõÁ®ã
            async function addSchedule() {
                try {
                    // Ëé∑ÂèñÂΩìÂâçÊâÄÊúâÈòü‰ºçÂêçÁß∞
                    const teamNames = teams.map(team => team.name).filter(name => name);

                    if (teamNames.length < 2) {
                        alert('Ëá≥Â∞ëÈúÄË¶Å‰∏§‰∏™Èòü‰ºçÊâçËÉΩÂàõÂª∫ÂØπÈòµÔºÅ');
                        return;
                    }

                    // ÈöèÊú∫ÈÄâÊã©‰∏§‰∏™‰∏çÂêåÁöÑÈòü‰ºç
                    let team1, team2;
                    do {
                        team1 = teamNames[Math.floor(Math.random() * teamNames.length)];
                        team2 = teamNames[Math.floor(Math.random() * teamNames.length)];
                    } while (team1 === team2);

                    // ÁîüÊàêÈöèÊú∫ÊØîÂàÜ
                    const homeScore = Math.floor(Math.random() * 3) + 1;
                    const awayScore = Math.floor(Math.random() * 3) + 1;
                    const score = `${homeScore}-${awayScore}`;

                    // ÁîüÊàêÈöèÊú∫Êó•ÊúüÊó∂Èó¥ÔºàÊú™Êù•7Â§©ÂÜÖÔºâ
                    const now = new Date();
                    const futureDate = new Date(now.getTime() + Math.random() * 7 * 24 * 60 * 60 * 1000);
                    const datetime = futureDate.toLocaleString('zh-CN', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    const schedule = {
                        id: nextScheduleId++,
                        team1: team1,
                        team2: team2,
                        datetime: datetime,
                        score: score
                    };

                    schedules.push(schedule);
                    renderSchedules();
                } catch (error) {
                    // Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú
                }
            }

            // ÁºñËæëËµõÁ®ã
            async function editSchedule(scheduleId) {
                const schedule = schedules.find(s => s.id === scheduleId);
                if (!schedule) return;

                try {
                    const team1 = await customPrompt('ÁºñËæëÂØπÈòµ', 'ËØ∑ËæìÂÖ•‰∏ªÈòüÂêçÁß∞Ôºö', schedule.team1, 'text');
                    if (!team1) return;

                    const team2 = await customPrompt('ÁºñËæëÂØπÈòµ', 'ËØ∑ËæìÂÖ•ÂÆ¢ÈòüÂêçÁß∞Ôºö', schedule.team2, 'text');
                    if (!team2) return;

                    const datetime = await customPrompt('ÁºñËæëÂØπÈòµ', 'ËØ∑ËæìÂÖ•ÊØîËµõÊó∂Èó¥Ôºö', schedule.datetime, 'text');
                    if (!datetime) return;

                    const score = await customPrompt('ÁºñËæëÂØπÈòµ', 'ËØ∑ËæìÂÖ•ÊØîÂàÜÔºàÊ†ºÂºèÔºö2-1ÔºâÔºö', schedule.score, 'text');
                    if (!score) return;

                    schedule.team1 = team1;
                    schedule.team2 = team2;
                    schedule.datetime = datetime;
                    schedule.score = score;

                    renderSchedules();
                } catch (error) {
                    // Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú
                }
            }

            // Âà†Èô§ËµõÁ®ã
            function deleteSchedule(scheduleId) {
                if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂØπÈòµÂêóÔºü')) {
                    return;
                }

                schedules = schedules.filter(s => s.id !== scheduleId);
                renderSchedules();
            }

            // Ëá™ÂÆö‰πâÈÄâÊã©Ê°ÜÂáΩÊï∞
            function customSelect(title, label, options, defaultValue = '') {
                return new Promise((resolve, reject) => {
                    modalResolve = resolve;
                    modalReject = reject;

                    modalTitle.textContent = title;
                    selectLabel.textContent = label;

                    // Ê∏ÖÁ©∫Âπ∂Â°´ÂÖÖÈÄâÊã©Ê°Ü
                    modalSelect.innerHTML = '';
                    options.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option;
                        optionElement.textContent = option;
                        modalSelect.appendChild(optionElement);
                    });

                    if (defaultValue) {
                        modalSelect.value = defaultValue;
                    }

                    // ÊòæÁ§∫ÈÄâÊã©Ê°ÜÔºåÈöêËóèËæìÂÖ•Ê°Ü
                    selectGroup.style.display = 'block';
                    modalInput.style.display = 'none';
                    identityGroup.style.display = 'none';

                    // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                    modal.classList.add('show');
                    modalSelect.focus();
                });
            }

            // ‰øùÂ≠òÈòµÂÆπ
            async function saveFormation() {
                try {
                    const name = await customPrompt('‰øùÂ≠òÈòµÂÆπ', 'ËØ∑ËæìÂÖ•ÈòµÂÆπÂêçÁß∞Ôºö', `ÈòµÂÆπ${nextFormationId}`, 'text');
                    if (!name) return;

                    const formation = {
                        id: nextFormationId++,
                        name: name,
                        teams: JSON.parse(JSON.stringify(teams)),
                        playersByPosition: JSON.parse(JSON.stringify(playersByPosition)),
                        timestamp: new Date().toISOString()
                    };

                    formations.push(formation);
                    currentFormationId = formation.id;
                    renderFormationTags();
                    alert('ÈòµÂÆπ‰øùÂ≠òÊàêÂäüÔºÅ');
                } catch (error) {
                    // Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú
                }
            }

            // ÂàáÊç¢ÈòµÂÆπ
            function switchFormation(formationId) {
                const formation = formations.find(f => f.id === formationId);
                if (!formation) return;

                teams = JSON.parse(JSON.stringify(formation.teams));
                playersByPosition = JSON.parse(JSON.stringify(formation.playersByPosition));
                currentFormationId = formationId;

                renderTeams();
                renderPlayerPool();
                renderFormationTags();
            }

            // ‰øÆÊîπÈòµÂÆπÂêçÁß∞
            async function editFormationName(formationId) {
                const formation = formations.find(f => f.id === formationId);
                if (!formation) return;

                try {
                    const newName = await customPrompt('‰øÆÊîπÈòµÂÆπÂêçÁß∞', 'ËØ∑ËæìÂÖ•Êñ∞ÁöÑÈòµÂÆπÂêçÁß∞Ôºö', formation.name, 'text');
                    if (newName) {
                        formation.name = newName;
                        renderFormationTags();
                    }
                } catch (error) {
                    // Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú
                }
            }

            // Âà†Èô§ÈòµÂÆπ
            function deleteFormation(formationId) {
                if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÈòµÂÆπÂêóÔºü')) {
                    return;
                }

                formations = formations.filter(f => f.id !== formationId);
                if (currentFormationId === formationId) {
                    currentFormationId = null;
                }
                renderFormationTags();
            }

            // ÂêØÁî®ÊãñÊîæÂäüËÉΩ
            function enableDragAndDrop() {
                // ÈÄâÊâãÊ±†‰∏≠ÁöÑÈÄâÊâã
                const playerItems = document.querySelectorAll('.player-item');
                playerItems.forEach(item => {
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragend', handleDragEnd);
                });

                // Èòü‰ºç‰∏≠ÁöÑÊàêÂëò
                const memberItems = document.querySelectorAll('.member-item');
                memberItems.forEach(item => {
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragend', handleDragEnd);
                    item.addEventListener('dragover', handleDragOver);
                    item.addEventListener('dragenter', handleDragEnter);
                    item.addEventListener('dragleave', handleDragLeave);
                    item.addEventListener('drop', handleDrop);
                });

                // Á©∫‰Ωç
                const emptySlots = document.querySelectorAll('.empty-slot');
                emptySlots.forEach(slot => {
                    slot.addEventListener('dragover', handleDragOver);
                    slot.addEventListener('dragenter', handleDragEnter);
                    slot.addEventListener('dragleave', handleDragLeave);
                    slot.addEventListener('drop', handleDrop);
                });
            }

            // ÊãñÊîæ‰∫ã‰ª∂Â§ÑÁêÜ
            let draggedItem = null;

            function handleDragStart(e) {
                draggedItem = this;
                this.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', this.dataset.playerId);
            }

            function handleDragEnd() {
                this.classList.remove('dragging');
                document.querySelectorAll('.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                draggedItem = null;
            }

            function handleDragOver(e) {
                e.preventDefault();
                return false;
            }

            function handleDragEnter(e) {
                this.classList.add('drag-over');
            }

            function handleDragLeave() {
                this.classList.remove('drag-over');
            }

            function handleDrop(e) {
                e.preventDefault();
                this.classList.remove('drag-over');

                if (draggedItem) {
                    const playerId = parseInt(draggedItem.dataset.playerId);

                    // Âà§Êñ≠ÊãñÊîæÁõÆÊ†á
                    if (this.classList.contains('empty-slot') || this.classList.contains('team-members')) {
                        // ÊãñÊîæÂà∞Á©∫‰ΩçÊàñÈòü‰ºçÊàêÂëòÂå∫Âüü
                        const targetTeamId = parseInt(this.closest('.team-card').dataset.teamId);
                        const targetTeam = teams.find(t => t.id === targetTeamId);

                        if (!targetTeam) return;

                        // Ê£ÄÊü•Èòü‰ºçÊòØÂê¶Â∑≤Êª°
                        if (targetTeam.members.length >= 5) {
                            alert('Èòü‰ºçÂ∑≤Êª°ÔºåÊó†Ê≥ïÊ∑ªÂä†Êõ¥Â§öÈÄâÊâãÔºÅ');
                            return;
                        }

                        // ‰ªéÈÄâÊâãÊ±†ÊãñÂä®Âà∞Èòü‰ºç
                        if (draggedItem.classList.contains('player-item')) {
                            addPlayerToTeamFromPool(playerId, targetTeamId);
                        }
                        // ‰ªéÈòü‰ºçÂÜÖÊàñË∑®Èòü‰ºçÊãñÂä®
                        else if (draggedItem.classList.contains('member-item')) {
                            const sourceTeamId = parseInt(draggedItem.dataset.teamId);
                            if (sourceTeamId !== targetTeamId) {
                                movePlayerBetweenTeams(playerId, sourceTeamId, targetTeamId);
                            }
                        }
                    }
                    // ÊãñÊîæÂà∞Â∑≤ÊúâÊàêÂëò‰ΩçÁΩÆÔºà‰∫§Êç¢Ôºâ
                    else if (this.classList.contains('member-item')) {
                        const targetTeamId = parseInt(this.closest('.team-card').dataset.teamId);
                        const targetPlayerId = parseInt(this.dataset.playerId);

                        // ‰ªéÈÄâÊâãÊ±†ÊãñÂä®Âà∞Èòü‰ºçÔºà‰∫§Êç¢Ôºâ
                        if (draggedItem.classList.contains('player-item')) {
                            swapPlayerWithPool(playerId, targetPlayerId, targetTeamId);
                        }
                        // ‰ªéÈòü‰ºçÂÜÖÊàñË∑®Èòü‰ºçÊãñÂä®Ôºà‰∫§Êç¢Ôºâ
                        else if (draggedItem.classList.contains('member-item')) {
                            const sourceTeamId = parseInt(draggedItem.dataset.teamId);
                            swapPlayersInTeams(playerId, sourceTeamId, targetPlayerId, targetTeamId);
                        }
                    }
                }

                return false;
            }

            // ‰ªéÈÄâÊâãÊ±†Ê∑ªÂä†ÈÄâÊâãÂà∞Èòü‰ºçÔºàÊåâÈ°∫Â∫èÊ∑ªÂä†Ôºâ
            function addPlayerToTeamFromPool(playerId, teamId) {
                const team = teams.find(t => t.id === teamId);
                if (!team) return;

                // Ê£ÄÊü•Èòü‰ºçÊòØÂê¶Â∑≤Êª°
                if (team.members.length >= 5) {
                    alert('Èòü‰ºçÂ∑≤Êª°ÔºåÊó†Ê≥ïÊ∑ªÂä†Êõ¥Â§öÈÄâÊâãÔºÅ');
                    return;
                }

                // ‰ªéÈÄâÊâãÊ±†‰∏≠ÁßªÈô§ÈÄâÊâã
                let player = null;
                for (const pos in playersByPosition) {
                    const index = playersByPosition[pos].findIndex(p => p.id === playerId);
                    if (index !== -1) {
                        player = playersByPosition[pos][index];
                        playersByPosition[pos].splice(index, 1);
                        break;
                    }
                }

                if (player) {
                    // ÊåâÈ°∫Â∫èÊ∑ªÂä†Âà∞Èòü‰ºçÔºà‰∏çÊåâ‰ΩçÁΩÆÔºâ
                    team.members.push(player);
                    renderTeams();
                    renderPlayerPool();
                }
            }

            // Âú®Èòü‰ºçÈó¥ÁßªÂä®ÈÄâÊâãÔºàÊåâÈ°∫Â∫èÊ∑ªÂä†Ôºâ
            function movePlayerBetweenTeams(playerId, sourceTeamId, targetTeamId) {
                const sourceTeam = teams.find(t => t.id === sourceTeamId);
                const targetTeam = teams.find(t => t.id === targetTeamId);
                if (!sourceTeam || !targetTeam) return;

                // Ê£ÄÊü•ÁõÆÊ†áÈòü‰ºçÊòØÂê¶Â∑≤Êª°
                if (targetTeam.members.length >= 5) {
                    alert('ÁõÆÊ†áÈòü‰ºçÂ∑≤Êª°ÔºåÊó†Ê≥ïÁßªÂä®ÈÄâÊâãÔºÅ');
                    return;
                }

                // ‰ªéÊ∫êÈòü‰ºç‰∏≠ÁßªÈô§ÈÄâÊâã
                const playerIndex = sourceTeam.members.findIndex(p => p.id === playerId);
                if (playerIndex === -1) return;

                const player = sourceTeam.members[playerIndex];
                sourceTeam.members.splice(playerIndex, 1);

                // ÊåâÈ°∫Â∫èÊ∑ªÂä†Âà∞ÁõÆÊ†áÈòü‰ºç
                targetTeam.members.push(player);
                renderTeams();
                renderPlayerPool();
            }

            // ÈÄâÊâãÊ±†ÈÄâÊâã‰∏éÈòü‰ºçÈÄâÊâã‰∫§Êç¢
            function swapPlayerWithPool(playerId, targetPlayerId, teamId) {
                const team = teams.find(t => t.id === teamId);
                if (!team) return;

                // ‰ªéÈÄâÊâãÊ±†‰∏≠Ëé∑ÂèñÈÄâÊâã
                let poolPlayer = null;
                for (const pos in playersByPosition) {
                    const index = playersByPosition[pos].findIndex(p => p.id === playerId);
                    if (index !== -1) {
                        poolPlayer = playersByPosition[pos][index];
                        playersByPosition[pos].splice(index, 1);
                        break;
                    }
                }

                if (!poolPlayer) return;

                // ‰ªéÈòü‰ºç‰∏≠Ëé∑ÂèñÈÄâÊâã
                const teamPlayerIndex = team.members.findIndex(p => p.id === targetPlayerId);
                if (teamPlayerIndex === -1) return;

                const teamPlayer = team.members[teamPlayerIndex];
                team.members.splice(teamPlayerIndex, 1);

                // Â∞ÜÈòü‰ºçÈÄâÊâãÊîæÂõûÈÄâÊâãÊ±†
                playersByPosition[teamPlayer.position].push(teamPlayer);

                // Â∞ÜÈÄâÊâãÊ±†ÈÄâÊâãÂä†ÂÖ•Èòü‰ºç
                team.members.push(poolPlayer);

                renderTeams();
                renderPlayerPool();
            }

            // Èòü‰ºçÈó¥ÈÄâÊâã‰∫§Êç¢
            function swapPlayersInTeams(playerId, sourceTeamId, targetPlayerId, targetTeamId) {
                const sourceTeam = teams.find(t => t.id === sourceTeamId);
                const targetTeam = teams.find(t => t.id === targetTeamId);
                if (!sourceTeam || !targetTeam) return;

                // Ëé∑ÂèñÊ∫êÈÄâÊâã
                const sourcePlayerIndex = sourceTeam.members.findIndex(p => p.id === playerId);
                if (sourcePlayerIndex === -1) return;

                const sourcePlayer = sourceTeam.members[sourcePlayerIndex];

                // Ëé∑ÂèñÁõÆÊ†áÈÄâÊâã
                const targetPlayerIndex = targetTeam.members.findIndex(p => p.id === targetPlayerId);
                if (targetPlayerIndex === -1) return;

                const targetPlayer = targetTeam.members[targetPlayerIndex];

                // ‰∫§Êç¢ÈÄâÊâã
                sourceTeam.members[sourcePlayerIndex] = targetPlayer;
                targetTeam.members[targetPlayerIndex] = sourcePlayer;

                renderTeams();
                renderPlayerPool();
            }

            // ‰ªéÈòü‰ºç‰∏≠ÁßªÈô§ÈÄâÊâã
            function removePlayerFromTeam(playerId, teamId) {
                const team = teams.find(t => t.id === teamId);
                if (!team) return;

                const playerIndex = team.members.findIndex(p => p.id === playerId);
                if (playerIndex === -1) return;

                const player = team.members[playerIndex];
                team.members.splice(playerIndex, 1);

                // Â∞ÜÈÄâÊâãÊîæÂõûÈÄâÊâãÊ±†
                playersByPosition[player.position].push(player);

                renderTeams();
                renderPlayerPool();
            }

            // ‰ªéÈÄâÊâãÊ±†‰∏≠ÁßªÈô§ÈÄâÊâã
            function removePlayerFromPool(playerId, position) {
                const positionPlayers = playersByPosition[position];
                const playerIndex = positionPlayers.findIndex(p => p.id === playerId);
                if (playerIndex === -1) return;

                positionPlayers.splice(playerIndex, 1);
                renderPlayerPool();
            }

            // ‰øÆÊîπÈÄâÊâãÁ≠âÁ∫ß
            async function changePlayerLevel(playerId, teamId = null) {
                let player = null;

                if (teamId) {
                    // Èòü‰ºç‰∏≠ÁöÑÈÄâÊâã
                    const team = teams.find(t => t.id === teamId);
                    if (!team) return;
                    player = team.members.find(p => p.id === playerId);
                } else {
                    // ÈÄâÊâãÊ±†‰∏≠ÁöÑÈÄâÊâã
                    for (const position in playersByPosition) {
                        player = playersByPosition[position].find(p => p.id === playerId);
                        if (player) break;
                    }
                }

                if (!player) return;

                try {
                    const newLevel = await customPrompt('‰øÆÊîπÈÄâÊâãÁ≠âÁ∫ß', 'ÈÄâÊã©Êñ∞ÁöÑÁ≠âÁ∫ßÔºö', player.level, 'select');
                    if (newLevel) {
                        player.level = newLevel;
                        if (teamId) {
                            renderTeams();
                        } else {
                            renderPlayerPool();
                        }
                    }
                } catch (error) {
                    // Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú
                }
            }

            // ÂàáÊç¢ÈÄâÊâãË∫´‰ªΩ
            async function togglePlayerIdentity(playerId, teamId = null) {
                let player = null;
                let team = null;

                if (teamId) {
                    // Èòü‰ºç‰∏≠ÁöÑÈÄâÊâã
                    team = teams.find(t => t.id === teamId);
                    if (!team) return;
                    player = team.members.find(p => p.id === playerId);
                } else {
                    // ÈÄâÊâãÊ±†‰∏≠ÁöÑÈÄâÊâã
                    for (const position in playersByPosition) {
                        player = playersByPosition[position].find(p => p.id === playerId);
                        if (player) break;
                    }
                }

                if (!player) return;

                // Â¶ÇÊûúÂ∑≤ÁªèÊòØÈòüÈïøÔºåÂàôÂèñÊ∂àÈòüÈïøË∫´‰ªΩ
                if (player.identity === 'ÈòüÈïø') {
                    player.identity = 'ÈòüÂëò';
                } else {
                    // Â¶ÇÊûúÊòØÈòü‰ºç‰∏≠ÁöÑÈÄâÊâãÔºåÊ£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÈòüÈïø
                    if (team) {
                        const existingCaptain = team.members.find(m => m.identity === 'ÈòüÈïø');
                        if (existingCaptain && existingCaptain.id !== playerId) {
                            try {
                                const confirmChange = await customPrompt('ÊåáÂÆöÈòüÈïø', 'ËØ•Èòü‰ºçÂ∑≤ÊúâÈòüÈïøÔºåÊòØÂê¶ÊõøÊç¢Ôºü', 'ÊòØ', 'text');
                                if (confirmChange && confirmChange.toLowerCase() === 'ÊòØ') {
                                    existingCaptain.identity = 'ÈòüÂëò';
                                    player.identity = 'ÈòüÈïø';
                                }
                            } catch (error) {
                                // Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú
                                return;
                            }
                        } else {
                            player.identity = 'ÈòüÈïø';
                        }
                    } else {
                        // ÈÄâÊâãÊ±†‰∏≠ÁöÑÈÄâÊâãÁõ¥Êé•ËÆæÁΩÆ‰∏∫ÈòüÈïø
                        player.identity = 'ÈòüÈïø';
                    }
                }

                if (teamId) {
                    renderTeams();
                } else {
                    renderPlayerPool();
                }
            }

            // Ê∑ªÂä†ÈÄâÊâãÂà∞‰ΩçÁΩÆ
            async function addPlayerToPosition(position) {
                try {
                    const name = await customPrompt('Ê∑ªÂä†ÈÄâÊâã', 'ËØ∑ËæìÂÖ•ÈÄâÊâãÂßìÂêçÔºö', '', 'text');
                    if (!name) return;

                    const level = await customPrompt('ÈÄâÊã©Á≠âÁ∫ß', 'ËØ∑ÈÄâÊã©ÈÄâÊâãÁ≠âÁ∫ßÔºö', 'Á≠ëÂü∫', 'select');
                    if (!level) return;

                    const identity = await customPrompt('ÈÄâÊã©Ë∫´‰ªΩ', 'ËØ∑ÈÄâÊã©ÈÄâÊâãË∫´‰ªΩÔºö', 'ÈòüÂëò', 'identity');
                    if (!identity) return;

                    const newPlayer = {
                        id: nextPlayerId++,
                        name: name,
                        position: position,
                        level: level,
                        identity: identity
                    };

                    playersByPosition[position].push(newPlayer);
                    renderPlayerPool();
                } catch (error) {
                    // Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú
                }
            }

            // ÁºñËæëÈòü‰ºçÂêçÁß∞
            async function editTeamName(teamId) {
                const team = teams.find(t => t.id === teamId);
                if (!team) return;

                try {
                    const newName = await customPrompt('‰øÆÊîπÈòü‰ºçÂêçÁß∞', 'ËØ∑ËæìÂÖ•Êñ∞ÁöÑÈòü‰ºçÂêçÁß∞Ôºö', team.name, 'text');
                    if (newName) {
                        team.name = newName;
                        renderTeams();
                    }
                } catch (error) {
                    // Áî®Êà∑ÂèñÊ∂àÊìç‰Ωú
                }
            }

            // Ê∑ªÂä†Èòü‰ºç
            function addTeam() {
                const newTeam = {
                    id: nextTeamId++,
                    name: `${nextTeamId - 1}Èòü`,
                    color: getRandomColor(),
                    members: []
                };
                teams.push(newTeam);
                renderTeams();
            }

            // ÁßªÈô§Èòü‰ºç
            function removeTeam(teamId) {
                if (teams.length <= 1) {
                    alert('Ëá≥Â∞ëÈúÄË¶Å‰øùÁïô‰∏Ä‰∏™Èòü‰ºçÔºÅ');
                    return;
                }

                const team = teams.find(t => t.id === teamId);
                if (!team) return;

                // Â∞ÜÈòü‰ºç‰∏≠ÁöÑÈÄâÊâãÊîæÂõûÈÄâÊâãÊ±†
                team.members.forEach(player => {
                    playersByPosition[player.position].push(player);
                });

                teams = teams.filter(t => t.id !== teamId);
                renderTeams();
                renderPlayerPool();
            }

            // Ëé∑ÂèñÈöèÊú∫È¢úËâ≤
            function getRandomColor() {
                const colors = [
                    '#dc3545', '#0d6efd', '#198754', '#fd7e14', '#6f42c1',
                    '#20c997', '#e83e8c', '#6610f2', '#0dcaf0', '#ffc107'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            // Ê∏ÖÁ©∫
            function clearAllTeams() {
                if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÈòü‰ºçÂêóÔºüÊâÄÊúâÈÄâÊâãÂ∞ÜÂõûÂà∞ÈÄâÊâãÊ±†„ÄÇ')) {
                    return;
                }

                // Â∞ÜÊâÄÊúâÈÄâÊâãÊîæÂõûÈÄâÊâãÊ±†
                teams.forEach(team => {
                    team.members.forEach(player => {
                        playersByPosition[player.position].push(player);
                    });
                    team.members = [];
                });

                renderTeams();
                renderPlayerPool();
            }

            // ÁîüÊàêÈòµÂÆπ - Êô∫ËÉΩÁâàÊú¨
            function generateTeams() {
                if (!confirm('Á°ÆÂÆöË¶ÅÁîüÊàêÈòµÂÆπÂêóÔºüÂ∞ÜÊ†πÊçÆÂΩìÂâçÈòµÂÆπÊÉÖÂÜµËøõË°åÊô∫ËÉΩÂàÜÈÖç„ÄÇ')) {
                    return;
                }

                // Ëé∑ÂèñÊâÄÊúâÂèØÁî®ÁöÑÈÄâÊâãÔºàÈÄâÊâãÊ±†‰∏≠ÁöÑÈÄâÊâãÔºâ
                const availablePlayers = [];
                for (const position in playersByPosition) {
                    playersByPosition[position].forEach(player => {
                        availablePlayers.push(player);
                    });
                }

                if (availablePlayers.length === 0) {
                    alert('ÈÄâÊâãÊ±†‰∏≠Ê≤°ÊúâÂèØÁî®ÁöÑÈÄâÊâãÔºÅ');
                    return;
                }

                // ËÆ°ÁÆóÂΩìÂâçÈòü‰ºçÊÉÖÂÜµ
                const teamCount = teams.length;
                let totalPlayersNeeded = 0;
                let currentPlayersCount = 0;

                // ÁªüËÆ°ÂΩìÂâçÂêÑÈòü‰ºçÊÉÖÂÜµ
                teams.forEach(team => {
                    currentPlayersCount += team.members.length;
                });

                // ËÆ°ÁÆóÈúÄË¶ÅË°•ÂÖÖÁöÑÈÄâÊâãÊï∞ÈáèÔºà‰ºòÂÖàË°•Êª°5‰∫∫Ôºâ
                const maxPlayersPerTeam = 5;
                totalPlayersNeeded = teamCount * maxPlayersPerTeam - currentPlayersCount;

                // Â¶ÇÊûúÈÄâÊâãÊï∞Èáè‰∏çË∂≥ÔºåË∞ÉÊï¥ÊØèÈòü‰∫∫Êï∞
                let targetPlayersPerTeam = maxPlayersPerTeam;
                if (availablePlayers.length < totalPlayersNeeded) {
                    // ËÆ°ÁÆóÊúÄÂ§ßÂèØÂàÜÈÖç‰∫∫Êï∞
                    const totalAvailablePlayers = availablePlayers.length + currentPlayersCount;
                    targetPlayersPerTeam = Math.floor(totalAvailablePlayers / teamCount);

                    if (targetPlayersPerTeam < 1) {
                        alert('ÈÄâÊâãÊï∞ÈáèÂ§™Â∞ëÔºåÊó†Ê≥ïËøõË°åÊúâÊïàÂàÜÈÖçÔºÅ');
                        return;
                    }

                    console.log(`ÈÄâÊâãÊï∞Èáè‰∏çË∂≥ÔºåË∞ÉÊï¥‰∏∫ÊØèÈòü${targetPlayersPerTeam}‰∫∫`);
                }

                // ÊåâÁ≠âÁ∫ßÊùÉÈáçÊéíÂ∫èÂèØÁî®ÈÄâÊâãÔºà‰ªéÈ´òÂà∞‰ΩéÔºâ
                const sortedPlayers = [...availablePlayers].sort((a, b) =>
                    levelWeights[b.level] - levelWeights[a.level]
                );

                // ËÆ°ÁÆóÂêÑÈòü‰ºçÂΩìÂâçÂÆûÂäõ
                const teamPowers = teams.map(team =>
                    team.members.reduce((sum, player) => sum + levelWeights[player.level], 0)
                );

                // ËÆ°ÁÆóÂêÑÈòü‰ºçËøòÈúÄË¶ÅË°•ÂÖÖÁöÑÈÄâÊâãÊï∞Èáè
                const playersNeededPerTeam = teams.map(team =>
                    Math.max(0, targetPlayersPerTeam - team.members.length)
                );

                // Êô∫ËÉΩÂàÜÈÖçÈÄâÊâã
                let remainingPlayers = [...sortedPlayers];

                // ‰∏∫ÊØè‰∏™ÈúÄË¶ÅË°•ÂÖÖÈÄâÊâãÁöÑÈòü‰ºçÂàÜÈÖçÈÄâÊâã
                while (remainingPlayers.length > 0) {
                    let assigned = false;

                    // ÊåâÁÖßÂÆûÂäõ‰ªé‰ΩéÂà∞È´òÁöÑÈ°∫Â∫è‰∏∫Èòü‰ºçÂàÜÈÖçÈÄâÊâãÔºà‰øùËØÅÂÆûÂäõÂùáË°°Ôºâ
                    const teamIndices = teams
                        .map((team, index) => ({ index, power: teamPowers[index], needed: playersNeededPerTeam[index] }))
                        .filter(team => team.needed > 0)
                        .sort((a, b) => a.power - b.power)
                        .map(team => team.index);

                    if (teamIndices.length === 0) break;

                    for (const teamIndex of teamIndices) {
                        const team = teams[teamIndex];

                        if (team.members.length >= targetPlayersPerTeam) continue;

                        // ‰∏∫Èòü‰ºçÂàÜÈÖçÈÄâÊâãÔºà‰∏çÈôêÂà∂‰ΩçÁΩÆÔºâ
                        if (remainingPlayers.length > 0) {
                            const player = remainingPlayers.shift();
                            team.members.push(player);
                            teamPowers[teamIndex] += levelWeights[player.level];
                            playersNeededPerTeam[teamIndex]--;

                            // ‰ªéÈÄâÊâãÊ±†‰∏≠ÁßªÈô§ËØ•ÈÄâÊâã
                            const posIndex = playersByPosition[player.position].findIndex(p => p.id === player.id);
                            if (posIndex !== -1) {
                                playersByPosition[player.position].splice(posIndex, 1);
                            }

                            assigned = true;
                        }
                    }

                    // Â¶ÇÊûúËøô‰∏ÄËΩÆÊ≤°ÊúâÂàÜÈÖç‰ªª‰ΩïÈÄâÊâãÔºåËØ¥ÊòéÊó†Ê≥ïÁªßÁª≠ÂàÜÈÖç
                    if (!assigned) break;
                }

                // Â¶ÇÊûúÈÄâÊã©‰ΩçÁΩÆÊéíÂ∫èÔºåÂàôÊåâ‰ΩçÁΩÆÊéíÂ∫è
                if (sortMethod === 'position') {
                    teams.forEach(team => {
                        team.members.sort((a, b) => positionOrder.indexOf(a.position) - positionOrder.indexOf(b.position));
                    });
                }

                renderTeams();
                renderPlayerPool();

                // ÊòæÁ§∫ÂàÜÈÖçÁªìÊûú
                let resultMessage = "ÈòµÂÆπÁîüÊàêÂÆåÊàêÔºÅ\n\nÂàÜÈÖçÁªìÊûúÔºö\n";
                teams.forEach(team => {
                    const totalPower = team.members.reduce((sum, player) => sum + levelWeights[player.level], 0);
                    resultMessage += `${team.name}: ${totalPower}ÁÇπÂÆûÂäõ (${team.members.length}/${targetPlayersPerTeam}‰∫∫)\n`;
                });
                resultMessage += `\nÊÄªÂÖ±‰ΩøÁî®‰∫Ü ${sortedPlayers.length - remainingPlayers.length} ÂêçÈÄâÊâã`;
                alert(resultMessage);
            }

            // ÂØºÂá∫ÈòµÂÆπÔºàÂåÖÂê´ÈòµÂÆπÂàóË°®ÂíåËµõÁ®ãÊï∞ÊçÆÔºâ
            function exportData() {
                const data = {
                    teams: teams,
                    playersByPosition: playersByPosition,
                    formations: formations,
                    schedules: schedules,
                    nextPlayerId: nextPlayerId,
                    nextTeamId: nextTeamId,
                    nextFormationId: nextFormationId,
                    nextScheduleId: nextScheduleId,
                    currentFormationId: currentFormationId
                };

                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });

                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'lol_formation_system.json';
                link.click();

                URL.revokeObjectURL(url);
            }

            // ÂØºÂÖ•ÈòµÂÆπÔºàÂåÖÂê´ÈòµÂÆπÂàóË°®ÂíåËµõÁ®ãÊï∞ÊçÆÔºâ
            function importData() {
                const fileInput = document.getElementById('importFile');
                fileInput.onchange = function (e) {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            importedData = data;

                            // Â∫îÁî®ÂØºÂÖ•ÁöÑÊï∞ÊçÆ
                            teams = data.teams || teams;
                            playersByPosition = data.playersByPosition || playersByPosition;
                            formations = data.formations || [];
                            schedules = data.schedules || [];
                            nextPlayerId = data.nextPlayerId || nextPlayerId;
                            nextTeamId = data.nextTeamId || nextTeamId;
                            nextFormationId = data.nextFormationId || nextFormationId;
                            nextScheduleId = data.nextScheduleId || nextScheduleId;
                            currentFormationId = data.currentFormationId || null;

                            renderTeams();
                            renderPlayerPool();
                            renderFormationTags();
                            alert('Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅ');
                        } catch (error) {
                            alert('ÂØºÂÖ•Â§±Ë¥•ÔºöÊñá‰ª∂Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºÅ');
                        }
                    };
                    reader.readAsText(file);
                    fileInput.value = '';
                };
                fileInput.click();
            }

            // ÁªëÂÆö‰∫ã‰ª∂
            function bindEvents() {
                document.getElementById('addTeamBtn').addEventListener('click', addTeam);
                document.getElementById('clearAllBtn').addEventListener('click', clearAllTeams);
                document.getElementById('generateTeamBtn').addEventListener('click', generateTeams);
                document.getElementById('saveFormationBtn').addEventListener('click', saveFormation);
                document.getElementById('scheduleBtn').addEventListener('click', openScheduleModal);
                document.getElementById('exportBtn').addEventListener('click', exportData);
                document.getElementById('importBtn').addEventListener('click', importData);

                // ÊéíÂ∫èÈÄâÊã©‰∫ã‰ª∂
                document.getElementById('sortSelect').addEventListener('change', function (e) {
                    sortMethod = e.target.value;
                    renderTeams();
                });
            }

            // ÂàùÂßãÂåñÂ∫îÁî®
            initApp();
        });
    </script>
</body>

</html>